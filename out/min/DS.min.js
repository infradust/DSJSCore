!function(a,b){b["true"]=a,function(a){"use strict";function b(a,b){var c=a;return void 0!==b&&(c=void 0!==a?function(){b.apply(this,arguments),a.apply(this,arguments)}:b),c}var c={};c.nop=function(){},c.setBase=function(a,b){for(var c in b)b.hasOwnProperty(c)&&"_name"!==c&&(a[c]=b[c]);a.prototype=Object.create(b.prototype),a.prototype.constructor=a},c.classRegistry={},c.makeClass=function(a){var d=void 0===a.base?Object:a.base,e=a.cnst||c.nop,f=a.baseArgs;if(d!==Object&&void 0===a.skipBase){var g=e;e=void 0===f?function(){var a=d.apply(this,arguments)||this;return a=g.apply(a,arguments)||this}:function(){var a=d.apply(this,f.apply(this,arguments))||this;return a=g.apply(a,arguments)||this}}else{var h=e;e=function(){var a=h.apply(this,arguments)||this;return a}}c.setBase(e,d),e._name=a.name,e._base=d;var i=a.namespace;void 0!==i&&(i[a.name]=e,e._namespace=i),void 0!==a.key&&(e._key=a.key,c.classRegistry[a.key]=e);var j=b(a.load,d._load);void 0!==j&&(e._load=j,j.call(e)),j=b(a.init,d._init),void 0!==j&&(e._init=j,j.call(e));var k=a.proto||c.nop;return k(e.prototype),e},c.getClass=function(a){return c.classRegistry[a]},c.registerClass=function(a,b){c.classRegistry[a]=b},c.unregisterClass=function(a){delete c.classRegistry[a]},c.namespace=function(a){var b=c[a];return void 0===b&&(b={},b._isNamespace=!0,c[a]=b),b},a.DS=c,a.setBase=c.setBase,console.log("DS loaded",c)}(window),function(a){var b,c,d=a.namespace("data");d.accessor=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments);return d.unshift(this),d.length===b+1?c=a.get.apply(a,d):a.set.apply(a,d),c};return c},b=a.makeClass({name:"DSDataRelation",namespace:d,cnst:function(a){this.inst=a.inst,this.prop=a.property}}),c=b.prototype,b=c=void 0,b=a.makeClass({name:"DSDataObject",namespace:d,cnst:function(a){this.$flags={},this.$values={},this.$changes={},this.$ownProperties={},this.$relations={},this.$isNew=!0,this.$setByKeys(a,!0)},load:function(){var a=this;this.$properties={},this.$store={},this.$getOrCreate=function(a){var b=a.key,c=this.$store,d=c[b];return void 0===d&&(d=new this(a),c[b]=d),d},this.$accessors=function(b){for(var c in a.$properties)a.$properties[c].setAccessor(b)},this.$removeProperty=function(b){var c=a.$properties[b];void 0!==c&&(delete a.$properties[b],c.removeAccessor(a.prototype))},this.$addProperty=function(b){void 0===a.$properties[b.key]?(a.$properties[b.key]=b,b.setAccessor(a.prototype)):console.log("property with key:",b.key,"already exists for class:",a._name)},this.$unsetAccessors=function(b){for(var c in a.$properties){var d=a.$properties[c];d.removeAccessor(b)}}},init:function(){this.$accessors(this.prototype)}}),c=b.prototype,c.$destroy=function(){this.constructor.$unsetAccessors(this);var a=this.$ownProperties;for(var b in a){var c=a[b];c.removeAccessor(this)}},c.$addProperty=function(a){var b=this.constructor,c=b.$properties[a.key];void 0===c&&(c=this.$ownProperties[a.key],void 0===c&&(this.$ownProperties[a.key]=a,a.setAccessor(this)))},c.$removeProperty=function(a){var b=this.$ownProperties[a];void 0!==b&&(b.remove(this),b.removeAccessor(this),delete this.$ownProperties[a])},c.$_propForKey=function(a){var b=this.constructor.$properties[a];return void 0===b&&(b=this.$ownProperties[a]),void 0===b&&console.log("property with key:",a," not found for:",this),b},c.$prop=function(a){return this.hasOwnProperty(a)?this[a].prop:void 0},c.$undo=function(){for(var a in this.$changes){var b=this.$_propForKey(a);b.undo(this)}},c.$access=function(){var a=this[arguments[0]];if(a){var b=Array.prototype.slice.call(arguments);b.shift(),a.apply(this,b)}else console.log("no accessor found for:",arguments[0],"on instance:",this)},c.$setByKey=function(a,b,c){var d=this.constructor,e=d.$properties[a];return void 0===e&&(e=this.$ownProperties[a],void 0===e)?void console.log("Could not find property for key:",a):void(c||this.$isNew?e.setPersistent(this,b):e.set(this,b))},c.$setByKeys=function(a,b){for(var c in a)this.$setByKey(c,a[c],b)},c.$hasChanges=function(){return this.$changes.length>0},b=c=void 0,b=a.makeClass({name:"DSBasicProperty",namespace:d,cnst:function(a){this.name=a.name?a.name:a.key,this.key=a.key?a.key:this.name,this.description=a.description,a["default"]&&(this["default"]=a["default"])}}),c=b.prototype,c._set=function(a,b){a.$values[this.key]=b},c.setupAccessor=function(a){a.prop=this},c.setAccessor=function(a){a.hasOwnProperty(this.name)&&console.log("property: ",c,"will override accessor named:",c.name,"instance:",a),this.hasOwnProperty("default")&&this._set(a,this["default"]);var b=d.accessor(this,0);this.setupAccessor(b),a[this.name]=b},c.removeAccessor=function(a){delete a[this.name]},c._willChange=function(a,b,c){a.$changes.hasOwnProperty(this.key)?a.$changes[this.key]===c&&delete a.$changes[this.key]:a.$changes[this.key]=b},c.setPersistent=function(a,b){if(a.$changes.hasOwnProperty(this.key)){if(a.$changes[this.key]===b)return;a.$values[this.key]!==b?this.$changes[this.key]=b:delete this.$changes[this.key]}else this._set(a,b)},c.set=function(a,b){var c=a.$values[this.key];c!==b&&(this._willChange(a,c,b),void 0===b?delete a.$values[this.key]:a.$values[this.key]=b)},c.undo=function(a){var b=a.$changes;b.hasOwnProperty(this.key)&&this.set(a,b[this.key])},c.setMulti=function(a,b){for(var c in b)this.set(a,b[c])},c.remove=function(a){var b=a.$values[this.key];void 0!==b&&(this._willChange(a,b,void 0),delete a.$values[this.key])},c.get=function(a){return a.$values[this.key]},c.modification=function(a){return a.$changes[this.key]},b=c=void 0,b=a.makeClass({name:"DSSetProperty",namespace:d,base:d.DSBasicProperty,cnst:function(){}}),c=b.prototype,c.get=function(a,b){return a.$values[this.key][b]},c._willChange=function(a,b,c,d){var e=a.$changes[this.key];e.hasOwnProperty(b)?e[b]===d&&delete e[b]:e[b]=c},c.set=function(a,b,c){var d=a.$values[this.key],e=d[b];c!==e&&(this._willChange(a,b,e,c),d[b]=c)},b=c=void 0,console.log("DS.data loaded",d)}(DS),function(a){var b,c,d=a.namespace("oo");d.idCounter=0,d.nextId=function(){return"$"+d.idCounter++},d.condSet=function(a,b,c){void 0!==c&&(a[b]=c)},b=a.makeClass({name:"DSObject",namespace:d}),c=b.prototype,b=c=void 0,b=a.makeClass({name:"DSKeyedObject",base:d.DSObject,namespace:d,cnst:function(a){this.$update(a)},load:function(){this.idField="key"}}),c=b.prototype,c.$setId=function(a,b){this.$id=function(){return a},this.$clientKey=b},c.$update=function(a){var b=this.constructor,c=a[b.idField],e=!1;void 0===c&&(e=!0,c=d.nextId()),this.$setId(c,e)},b=c=void 0,a.makeClass({name:"DSCachedObject",base:d.DSKeyedObject,namespace:d,cnst:function(){var a=this.constructor,b=a.cacheKey(this.$id()),c=a.cache[b];return void 0!==c?c:void(a.cache[b]=this)},load:function(){this.namespace="",this.sharedCache=!1,this.initCache=function(){return{}},this.cacheKey=function(a){return this.namespace+a},this.clearCache=function(){var a=this.cache;for(var b in a)a.hasOwnProperty(b)&&delete a[b]},this.$getOrCreate=function(a,b){var c=this.cache,d=c[this.cacheKey(a)];return void 0===d&&(d=new this(b)),d},this.$get=function(a){return this.cache[this.cacheKey(a)]}},init:function(){this.cache=this.initCache()}}),console.log("DS.oo loaded",d)}(DS),function(a){var b=a.namespace("patterns"),c=a.makeClass({name:"DSRegistry",namespace:b,cnst:function(){this._cache={}}});p=c.prototype,p.register=function(a,b){this._cache[a]=b},p.unregister=function(a){delete this._cache[a]},p.get=function(a){return this._cache[a]}}(DS)}({},function(){return this}());
//# sourceMappingURL=DS.min.js.map